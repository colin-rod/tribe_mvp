# =====================================================
# Supabase Connection Pool Configuration
# =====================================================
#
# This file contains environment variables for configuring
# database connection pooling. Copy these to your .env.local
# file and adjust values based on your environment.
#
# For production deployments, configure these in your hosting
# platform's environment variables (Vercel, Railway, etc.)

# -----------------------------------------------------
# Connection Pool Size Configuration
# -----------------------------------------------------

# Maximum number of connections in the pool
# - Development: 5-10 connections
# - Production: 10-20 connections
# - High load production: 20-50 connections
#
# Note: Supabase Free tier has a limit of 60 concurrent connections
# Note: Supabase Pro tier has a limit of 200 concurrent connections
DATABASE_POOL_MAX=20

# Minimum number of idle connections to maintain
# - Development: 2-5 connections
# - Production: 5-10 connections
DATABASE_POOL_MIN=5

# -----------------------------------------------------
# Connection Timeout Configuration
# -----------------------------------------------------

# Maximum time (ms) to wait for a connection from the pool
# If a connection is not available within this time, the request fails
# Recommended: 5000-10000ms (5-10 seconds)
DATABASE_CONNECTION_TIMEOUT=10000

# Maximum time (ms) a connection can remain idle before being closed
# Recommended: 10000-30000ms (10-30 seconds)
DATABASE_IDLE_TIMEOUT=30000

# Maximum lifetime (ms) of a connection before it's recycled
# Recommended: 600000-1800000ms (10-30 minutes)
DATABASE_MAX_LIFETIME=1800000

# -----------------------------------------------------
# Query Timeout Configuration
# -----------------------------------------------------

# Maximum time (ms) for a single query to execute
# Prevents long-running queries from blocking the pool
# Recommended: 30000-60000ms (30-60 seconds)
DATABASE_STATEMENT_TIMEOUT=30000

# -----------------------------------------------------
# Monitoring Configuration
# -----------------------------------------------------

# Enable logging of slow queries
# Values: true or false
DATABASE_LOG_SLOW_QUERIES=true

# Threshold (ms) for logging slow queries
# Queries taking longer than this will be logged
# Recommended: 1000-3000ms (1-3 seconds)
DATABASE_SLOW_QUERY_THRESHOLD=1000

# -----------------------------------------------------
# Supabase Database Connection (Advanced)
# -----------------------------------------------------

# Direct database connection string (optional)
# If not provided, constructed from NEXT_PUBLIC_SUPABASE_URL
# Format: postgresql://postgres:[PASSWORD]@db.[PROJECT_REF].supabase.co:6543/postgres
#
# Port 6543: Transaction mode (pooled, recommended)
# Port 5432: Session mode (direct connection)
# DATABASE_URL=postgresql://postgres:your-password@db.your-project.supabase.co:6543/postgres?pgbouncer=true

# Supabase database password (required for direct connections)
# Get this from: Supabase Dashboard > Settings > Database > Connection String
# SUPABASE_DB_PASSWORD=your-database-password

# =====================================================
# Recommended Settings by Environment
# =====================================================

# DEVELOPMENT (Local)
# -------------------
# DATABASE_POOL_MAX=10
# DATABASE_POOL_MIN=2
# DATABASE_CONNECTION_TIMEOUT=5000
# DATABASE_IDLE_TIMEOUT=10000
# DATABASE_MAX_LIFETIME=600000
# DATABASE_STATEMENT_TIMEOUT=60000
# DATABASE_LOG_SLOW_QUERIES=true
# DATABASE_SLOW_QUERY_THRESHOLD=2000

# STAGING
# -------
# DATABASE_POOL_MAX=15
# DATABASE_POOL_MIN=5
# DATABASE_CONNECTION_TIMEOUT=10000
# DATABASE_IDLE_TIMEOUT=20000
# DATABASE_MAX_LIFETIME=1200000
# DATABASE_STATEMENT_TIMEOUT=45000
# DATABASE_LOG_SLOW_QUERIES=true
# DATABASE_SLOW_QUERY_THRESHOLD=1500

# PRODUCTION (Standard Load)
# --------------------------
# DATABASE_POOL_MAX=20
# DATABASE_POOL_MIN=5
# DATABASE_CONNECTION_TIMEOUT=10000
# DATABASE_IDLE_TIMEOUT=30000
# DATABASE_MAX_LIFETIME=1800000
# DATABASE_STATEMENT_TIMEOUT=30000
# DATABASE_LOG_SLOW_QUERIES=true
# DATABASE_SLOW_QUERY_THRESHOLD=1000

# PRODUCTION (High Load)
# ----------------------
# DATABASE_POOL_MAX=50
# DATABASE_POOL_MIN=10
# DATABASE_CONNECTION_TIMEOUT=15000
# DATABASE_IDLE_TIMEOUT=30000
# DATABASE_MAX_LIFETIME=1800000
# DATABASE_STATEMENT_TIMEOUT=30000
# DATABASE_LOG_SLOW_QUERIES=true
# DATABASE_SLOW_QUERY_THRESHOLD=500

# =====================================================
# Supabase Connection Limits by Tier
# =====================================================
#
# Free Tier: 60 concurrent connections
# Pro Tier: 200 concurrent connections
# Enterprise: Custom limits
#
# Important: Leave headroom for:
# - Connection pooler overhead (~10%)
# - Background jobs and cron tasks
# - Admin connections
# - Concurrent user requests
#
# Example for Free Tier (60 connections):
# - Application pool: 40 connections
# - Background jobs: 10 connections
# - Admin/maintenance: 5 connections
# - Reserved: 5 connections
#
# =====================================================
# Troubleshooting
# =====================================================
#
# "Too many connections" error:
# - Reduce DATABASE_POOL_MAX
# - Increase DATABASE_IDLE_TIMEOUT
# - Check for connection leaks in application code
# - Consider upgrading Supabase tier
#
# Slow query performance:
# - Enable DATABASE_LOG_SLOW_QUERIES
# - Lower DATABASE_SLOW_QUERY_THRESHOLD
# - Analyze slow query logs
# - Add database indexes
#
# Connection timeout errors:
# - Increase DATABASE_CONNECTION_TIMEOUT
# - Increase DATABASE_POOL_MAX
# - Check Supabase dashboard for connection usage
#
# =====================================================
