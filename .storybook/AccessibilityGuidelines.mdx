import { Meta } from '@storybook/blocks'

<Meta title="Design System/Accessibility Guidelines" />

# Accessibility Guidelines

Accessibility is a core principle of the Tribe MVP design system. These guidelines ensure that all users, regardless of ability, can effectively use our application.

## Commitment to Accessibility

We are committed to meeting and exceeding **WCAG 2.1 Level AA** standards. Every component in this design system is built with accessibility as a fundamental requirement, not an afterthought.

## Key Principles

### 1. Perceivable
Information and user interface components must be presentable to users in ways they can perceive.

### 2. Operable
User interface components and navigation must be operable by all users.

### 3. Understandable
Information and the operation of the user interface must be understandable.

### 4. Robust
Content must be robust enough to be interpreted by a wide variety of user agents, including assistive technologies.

## Color & Contrast

### Contrast Ratios

All text and interactive elements meet WCAG contrast requirements:

**Normal Text (< 24px / 18px bold)**
- Minimum: 4.5:1 contrast ratio
- Enhanced: 7:1 contrast ratio (AAA)

**Large Text (≥ 24px / 18px bold)**
- Minimum: 3:1 contrast ratio
- Enhanced: 4.5:1 contrast ratio (AAA)

**Interactive Elements**
- UI components: 3:1 minimum contrast
- Focus indicators: 3:1 minimum contrast
- Active states: 3:1 minimum contrast

### Testing Contrast

Use these tools to verify contrast ratios:
- [WebAIM Contrast Checker](https://webaim.org/resources/contrastchecker/)
- Chrome DevTools Accessibility panel
- Our automated contrast testing script: `npm run check:contrast`

### Color Blindness Considerations

**Never rely on color alone** to convey information:
- ✅ Use icons + color for status indicators
- ✅ Use text labels + color for form validation
- ✅ Use patterns + color for charts
- ❌ Color-only status indicators
- ❌ Color-only error states

**Test your designs** with color blindness simulators:
- Chrome DevTools Vision Deficiency Emulator
- [Colorblind Web Page Filter](https://www.toptal.com/designers/colorfilter)

## Typography

### Font Size

**Body Text**
- Minimum: 16px (1rem)
- Recommended: 16-18px for optimal readability
- Never use font sizes smaller than 14px for body text

**Headings**
- Maintain clear size hierarchy
- Scale appropriately on mobile devices
- Use semantic HTML (h1-h6)

### Line Height & Spacing

**Line Height**
- Body text: 1.5 minimum (WCAG 2.1)
- Headings: 1.2-1.3
- Tight spaces: 1.25 minimum

**Line Length**
- Optimal: 50-75 characters per line
- Maximum: 80 characters per line
- Use max-width to prevent lines from becoming too long

**Letter Spacing**
- Normal text: default (0)
- All caps: 0.05em - 0.1em
- Avoid negative letter spacing

**Paragraph Spacing**
- At least 2x the line height
- Use margin-bottom for consistent spacing

## Keyboard Navigation

### Tab Order

**Logical Tab Order**
- Follow visual flow (left-to-right, top-to-bottom)
- Skip to main content link at the top
- Don't trap keyboard focus
- Avoid positive tabindex values

**Focus Indicators**
- Visible focus indicators on all interactive elements
- Minimum 2px outline or border
- Sufficient contrast (3:1 against background)
- Never remove focus indicators with `outline: none` without replacement

### Keyboard Shortcuts

**Essential Keyboard Support**
- `Tab` / `Shift+Tab`: Navigate forward/backward
- `Enter` / `Space`: Activate buttons and links
- `Esc`: Close modals and dialogs
- Arrow keys: Navigate within components (menus, tabs, etc.)

**Custom Shortcuts**
- Document all keyboard shortcuts
- Avoid conflicts with browser/screen reader shortcuts
- Provide keyboard shortcut reference (help dialog)

### Skip Links

Provide skip navigation links for:
- Skip to main content
- Skip navigation menu
- Skip to footer

Example:
```tsx
<a href="#main-content" className="skip-link">
  Skip to main content
</a>
```

## Screen Readers

### Semantic HTML

**Use proper HTML elements**
- `<button>` for actions
- `<a>` for navigation
- `<nav>` for navigation sections
- `<main>` for main content
- `<header>`, `<footer>` for page structure
- `<article>`, `<section>` for content grouping

**Heading Hierarchy**
- One `<h1>` per page
- Don't skip heading levels
- Headings describe section content
- Visual design shouldn't dictate heading level

### ARIA Labels & Attributes

**When to use ARIA**
- When semantic HTML isn't sufficient
- For dynamic content and complex widgets
- To enhance existing semantics

**Common ARIA Attributes**

`aria-label`: Provides accessible name
```tsx
<button aria-label="Close dialog">
  <XIcon className="h-5 w-5" />
</button>
```

`aria-describedby`: Additional description
```tsx
<input
  id="email"
  aria-describedby="email-hint email-error"
/>
<div id="email-hint">We'll never share your email</div>
<div id="email-error">Please enter a valid email</div>
```

`aria-live`: Announces dynamic content
```tsx
<div aria-live="polite" aria-atomic="true">
  Update saved successfully
</div>
```

`aria-expanded`: Collapsible sections
```tsx
<button aria-expanded={isOpen}>
  Show more
</button>
```

`aria-hidden`: Hide decorative elements
```tsx
<span aria-hidden="true">→</span>
```

### Alt Text

**Images**
- Descriptive alt text for meaningful images
- Empty alt (`alt=""`) for decorative images
- Context matters: describe image purpose, not just appearance

Examples:
```tsx
// Informative image
<img src="chart.png" alt="Sales increased 45% in Q3" />

// Decorative image
<img src="divider.png" alt="" />

// Functional image
<button>
  <img src="trash.png" alt="Delete item" />
</button>
```

### Screen Reader Testing

**Test with screen readers:**
- **macOS**: VoiceOver (Cmd+F5)
- **Windows**: NVDA (free) or JAWS
- **iOS**: VoiceOver (Settings > Accessibility)
- **Android**: TalkBack (Settings > Accessibility)

**Testing checklist:**
- Navigate with keyboard only
- Read content in logical order
- Understand all interactive elements
- Receive appropriate feedback for actions
- Perceive state changes and updates

## Forms

### Labels & Instructions

**Every input needs a label**
```tsx
// ✅ Correct
<label htmlFor="email">
  Email Address
</label>
<input id="email" type="email" />

// ❌ Incorrect (placeholder is not a label)
<input type="email" placeholder="Email Address" />
```

**Required Fields**
- Indicate required fields clearly
- Use `required` attribute
- Use `aria-required="true"` for custom inputs
- Don't rely on color or asterisk alone

**Instructions**
- Provide clear instructions before form
- Use `aria-describedby` to associate instructions with inputs
- Explain format requirements (e.g., "MM/DD/YYYY")

### Error Handling

**Error Messages**
- Announce errors to screen readers
- Use `aria-invalid="true"` on invalid inputs
- Use `aria-describedby` to associate error messages
- Provide specific, actionable error messages

**Example:**
```tsx
<input
  id="email"
  type="email"
  aria-invalid={hasError}
  aria-describedby={hasError ? "email-error" : undefined}
/>
{hasError && (
  <div id="email-error" role="alert">
    Please enter a valid email address
  </div>
)}
```

**Error Summary**
- Provide summary of all errors at top of form
- Include links to fields with errors
- Focus error summary on form submission

### Form Validation

**Timing**
- Validate on blur, not on every keystroke
- Don't show errors on pristine fields
- Validate on submit
- Show success states when appropriate

**Inline Validation**
- Show validation results near the input
- Use color + icon + text (not color alone)
- Keep validation visible while user corrects

## Interactive Components

### Buttons

**Accessible Button Requirements**
- Use `<button>` element (not div or span)
- Provide accessible name (text content or aria-label)
- Include focus indicator
- Support keyboard activation (Enter and Space)
- Disabled buttons should not receive focus

**Icon Buttons**
```tsx
<button aria-label="Add to favorites">
  <HeartIcon className="h-5 w-5" />
</button>
```

**Loading States**
```tsx
<button disabled={loading} aria-busy={loading}>
  {loading ? 'Saving...' : 'Save'}
</button>
```

### Links

**Link Requirements**
- Use `<a>` element with `href` attribute
- Provide meaningful link text (avoid "click here")
- Indicate external links
- Distinguish links from surrounding text

**Examples:**
```tsx
// ✅ Meaningful link text
<a href="/about">Learn more about our story</a>

// ❌ Generic link text
<a href="/about">Click here</a>

// External link
<a href="https://example.com" target="_blank" rel="noopener noreferrer">
  External site <ExternalLinkIcon aria-hidden="true" />
  <span className="sr-only">(opens in new window)</span>
</a>
```

### Modals & Dialogs

**Modal Requirements**
- Trap focus within modal
- Focus first interactive element on open
- Return focus to trigger element on close
- Close on Esc key
- Provide clear close button
- Use `role="dialog"` and `aria-modal="true"`
- Label with `aria-labelledby`

**Example:**
```tsx
<div
  role="dialog"
  aria-modal="true"
  aria-labelledby="dialog-title"
>
  <h2 id="dialog-title">Confirm Delete</h2>
  {/* dialog content */}
  <button onClick={onClose}>Cancel</button>
  <button onClick={onConfirm}>Delete</button>
</div>
```

### Dropdowns & Menus

**Dropdown Requirements**
- Keyboard navigation (Arrow keys)
- Proper ARIA roles (`menu`, `menuitem`)
- Focus management
- Close on Esc key
- Close on outside click

**Select Inputs**
- Use native `<select>` when possible
- Custom selects need full keyboard support
- Announce selected option to screen readers
- Support type-ahead search

### Tooltips

**Tooltip Guidelines**
- Don't hide essential information in tooltips
- Tooltips should supplement, not replace, labels
- Show on hover AND focus
- Don't require precise mouse movement
- Dismiss on Esc key
- Use `aria-describedby` to associate tooltip

## Dynamic Content

### Live Regions

**Announcing Updates**
Use ARIA live regions for dynamic content updates:

```tsx
// Polite announcement (waits for pause)
<div aria-live="polite" aria-atomic="true">
  {message}
</div>

// Assertive announcement (interrupts)
<div aria-live="assertive" aria-atomic="true">
  {error}
</div>
```

**Use Cases**
- Form submission feedback
- Error messages
- Loading states
- Status updates
- Real-time notifications

### Loading States

**Loading Indicators**
- Announce loading state to screen readers
- Use `aria-busy="true"` on loading container
- Provide text alternative ("Loading...")
- Show skeleton screens for better perceived performance

**Example:**
```tsx
<div aria-busy={isLoading} aria-live="polite">
  {isLoading ? (
    <>
      <LoadingSpinner />
      <span className="sr-only">Loading updates...</span>
    </>
  ) : (
    <UpdatesList updates={updates} />
  )}
</div>
```

## Mobile Accessibility

### Touch Targets

**Minimum Size**
- 44x44 pixels minimum (iOS guideline)
- 48x48 pixels recommended (Material Design)
- Adequate spacing between targets (8px minimum)

**Implementation**
```tsx
// Visually small, but large touch target
<button className="p-3">
  <Icon className="h-5 w-5" />
</button>
```

### Gestures

**Gesture Support**
- Don't require complex gestures
- Provide alternatives to gestures
- Support one-handed operation
- Consider reachability on large phones

### Zoom & Text Resize

**Requirements**
- Support pinch-to-zoom (don't disable)
- Support text resize up to 200%
- Use relative units (rem, em) not fixed pixels
- Test at 200% zoom
- Don't rely on horizontal scrolling

## Testing

### Automated Testing

**Tools We Use**
- **jest-axe**: Automated accessibility testing in Jest
- **Storybook a11y addon**: Visual accessibility checking
- **ESLint jsx-a11y plugin**: Linting for accessibility issues

**Running Tests**
```bash
# Unit tests with jest-axe
npm run test:a11y

# Contrast checking
npm run check:contrast

# All tests
npm test
```

### Manual Testing

**Testing Checklist**
- [ ] Keyboard navigation works for all interactive elements
- [ ] Focus indicators are visible and clear
- [ ] Screen reader announces all content correctly
- [ ] Color contrast meets WCAG requirements
- [ ] Form labels and error messages are clear
- [ ] Images have appropriate alt text
- [ ] Dynamic content updates are announced
- [ ] Modal focus is properly managed
- [ ] Content is readable at 200% zoom
- [ ] Touch targets are adequately sized

### Browser Testing

**Test in multiple browsers:**
- Chrome/Edge (Chromium)
- Firefox
- Safari (macOS and iOS)

**Test with assistive technologies:**
- Screen readers (VoiceOver, NVDA, JAWS)
- Voice control (Voice Control, Dragon)
- Switch control
- Screen magnifiers

## Common Mistakes to Avoid

### ❌ Don't Do This

1. **Remove focus indicators**
   ```css
   /* ❌ Never do this */
   *:focus { outline: none; }
   ```

2. **Use placeholder as label**
   ```tsx
   /* ❌ Placeholder is not a label */
   <input placeholder="Email Address" />
   ```

3. **Rely on color alone**
   ```tsx
   /* ❌ No icon or text, only color difference */
   <span className="text-red-500">Invalid</span>
   ```

4. **Use divs for buttons**
   ```tsx
   /* ❌ Div doesn't have button semantics */
   <div onClick={handleClick}>Click me</div>
   ```

5. **Inaccessible icon buttons**
   ```tsx
   /* ❌ No accessible name */
   <button><XIcon /></button>
   ```

### ✅ Do This Instead

1. **Provide visible focus indicators**
   ```css
   /* ✅ Clear focus indicators */
   button:focus-visible {
     outline: 2px solid var(--primary-500);
     outline-offset: 2px;
   }
   ```

2. **Always provide labels**
   ```tsx
   /* ✅ Explicit label */
   <label htmlFor="email">Email Address</label>
   <input id="email" type="email" />
   ```

3. **Use multiple indicators**
   ```tsx
   /* ✅ Icon + color + text */
   <div className="text-red-500 flex items-center gap-2">
     <AlertIcon aria-hidden="true" />
     <span>Invalid email address</span>
   </div>
   ```

4. **Use semantic HTML**
   ```tsx
   /* ✅ Proper button element */
   <button onClick={handleClick}>Click me</button>
   ```

5. **Provide accessible names**
   ```tsx
   /* ✅ aria-label for icon-only button */
   <button aria-label="Close">
     <XIcon />
   </button>
   ```

## Resources

### Documentation
- [WCAG 2.1 Guidelines](https://www.w3.org/WAI/WCAG21/quickref/)
- [WAI-ARIA Authoring Practices](https://www.w3.org/WAI/ARIA/apg/)
- [MDN Accessibility](https://developer.mozilla.org/en-US/docs/Web/Accessibility)
- [React Accessibility](https://react.dev/learn/accessibility)
- [Inclusive Components](https://inclusive-components.design/)

### Testing Tools
- [axe DevTools](https://www.deque.com/axe/devtools/)
- [WebAIM Contrast Checker](https://webaim.org/resources/contrastchecker/)
- [WAVE Browser Extension](https://wave.webaim.org/extension/)
- [Accessibility Insights](https://accessibilityinsights.io/)

### Screen Readers
- [VoiceOver User Guide (macOS/iOS)](https://www.apple.com/voiceover/info/guide/)
- [NVDA User Guide (Windows)](https://www.nvaccess.org/files/nvda/documentation/userGuide.html)
- [JAWS Documentation](https://www.freedomscientific.com/products/software/jaws/)

### Learning
- [A11ycasts YouTube Series](https://www.youtube.com/playlist?list=PLNYkxOF6rcICWx0C9LVWWVqvHlYJyqw7g)
- [Accessible Web Design Course](https://www.udacity.com/course/web-accessibility--ud891)
- [WebAIM Articles](https://webaim.org/articles/)

---

**Remember**: Accessibility is not a feature to be added later—it's a fundamental requirement that should be considered from the very beginning of the design and development process.

